# B站外链支持说明

## 功能概述

视频关卡现在支持两种上传方式：
1. **上传视频文件**（原有方式）
2. **填写视频 URL**（新增，支持 B站、YouTube 等外链）

## 使用方法

### 方式 1：填写 B站视频 URL（推荐）

1. 在管理页面，选择"视频关卡"
2. 填写"关卡标题"和"关卡描述"
3. 在"视频 URL"输入框中填写 B站视频链接
   - 例如：`https://www.bilibili.com/video/BV1xx411c7mu`
   - 或：`https://b23.tv/BV1xx411c7mu`
4. 点击"上传视频关卡"

**注意**：填写视频 URL 后，无需上传文件。

### 方式 2：上传视频文件

1. 在管理页面，选择"视频关卡"
2. 填写"关卡标题"和"关卡描述"
3. 点击"上传视频"区域，选择视频文件
4. 点击"上传视频关卡"

**注意**：文件大小限制 4MB（Vercel 限制）。

## 支持的视频平台

### B站（Bilibili）

- **URL 格式**：
  - `https://www.bilibili.com/video/BVxxxxx`
  - `https://b23.tv/BVxxxxx`
- **自动识别**：系统会自动识别 B站链接并转换为嵌入格式
- **播放方式**：使用 B站官方播放器（iframe）

### YouTube

- **URL 格式**：
  - `https://www.youtube.com/watch?v=xxxxx`
  - `https://youtu.be/xxxxx`
- **自动识别**：系统会自动识别 YouTube 链接并转换为嵌入格式
- **播放方式**：使用 YouTube 官方播放器（iframe）

### 其他视频平台

- 支持直接填写视频文件的 URL
- 使用标准的 HTML5 `<video>` 标签播放

## 编辑视频关卡

编辑视频关卡时：
1. 可以修改视频 URL
2. 支持从本地文件切换到外部链接
3. 支持从外部链接切换到本地文件
4. 可以预览当前视频（B站和 YouTube 会显示嵌入播放器）

## 技术实现

### 后端

- `POST /api/levels/video`：支持 `videoUrl` 参数
- `PUT /api/levels/:id`：支持更新 `videoUrl`
- 自动识别外部链接，不会尝试删除外部链接的文件

### 前端学生端

- 自动识别 B站链接，转换为嵌入格式
- 自动识别 YouTube 链接，转换为嵌入格式
- 其他外部链接使用 `<video>` 标签
- 本地文件使用完整的 API URL

## 优势

1. **绕过文件大小限制**：B站视频不受 4MB 限制
2. **更好的播放体验**：使用平台官方播放器
3. **节省存储空间**：不需要上传视频文件
4. **支持更多功能**：B站播放器的弹幕、字幕等功能

## 注意事项

1. **B站视频需要公开**：私有视频可能无法播放
2. **网络要求**：需要能够访问 B站和 YouTube
3. **跨域限制**：某些视频平台可能有跨域限制

## 示例

### B站视频示例

```
关卡标题：数字面具的魔法
关卡描述：学习数字面具的制作方法
视频 URL：https://www.bilibili.com/video/BV1xx411c7mu
```

### YouTube 视频示例

```
关卡标题：相机里的魔法
关卡描述：学习相机特效的制作
视频 URL：https://www.youtube.com/watch?v=xxxxx
```

## 常见问题

### Q: B站视频无法播放？

A: 检查：
1. 视频是否公开
2. 网络是否能够访问 B站
3. URL 格式是否正确（必须包含 BV 号）

### Q: 可以同时填写 URL 和上传文件吗？

A: 不可以。系统优先使用 URL，如果填写了 URL，上传的文件会被忽略。

### Q: 编辑时可以更换视频吗？

A: 可以。在编辑页面修改视频 URL 即可。
