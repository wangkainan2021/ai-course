<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¦ç»†è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-item {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #5568d3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .detail {
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è¯¦ç»†è¯Šæ–­å·¥å…·</h1>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <div id="results"></div>
    </div>

    <script>
        const API_URL = 'https://backend-topaz-zeta-46.vercel.app/api';
        const results = [];

        async function testEndpoint(name, url, method = 'GET', body = null) {
            const startTime = Date.now();
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                const duration = Date.now() - startTime;
                const contentType = response.headers.get('content-type');
                
                let data;
                try {
                    data = await response.json();
                } catch (e) {
                    data = await response.text();
                }

                return {
                    name,
                    success: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    duration: `${duration}ms`,
                    contentType,
                    data,
                    error: null
                };
            } catch (error) {
                const duration = Date.now() - startTime;
                return {
                    name,
                    success: false,
                    status: null,
                    statusText: null,
                    duration: `${duration}ms`,
                    contentType: null,
                    data: null,
                    error: {
                        message: error.message,
                        name: error.name,
                        stack: error.stack
                    }
                };
            }
        }

        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="test-item info">æ­£åœ¨è¿è¡Œæµ‹è¯•...</div>';

            const tests = [
                { name: 'API æ ¹è·¯å¾„', url: `${API_URL}`, method: 'GET' },
                { name: 'è¯¾ç¨‹åˆ—è¡¨', url: `${API_URL}/courses`, method: 'GET' },
                { name: 'å…³å¡åˆ—è¡¨', url: `${API_URL}/levels`, method: 'GET' },
            ];

            const testResults = [];
            for (const test of tests) {
                const result = await testEndpoint(test.name, test.url, test.method);
                testResults.push(result);
                
                // å®æ—¶æ˜¾ç¤ºç»“æœ
                displayResults(testResults);
                await new Promise(resolve => setTimeout(resolve, 500)); // å»¶è¿Ÿä»¥ä¾¿è§‚å¯Ÿ
            }

            displayResults(testResults);
        }

        function displayResults(testResults) {
            const resultsDiv = document.getElementById('results');
            let html = '';

            testResults.forEach(result => {
                const statusClass = result.success ? 
                    (result.data && result.data.success !== false ? 'success' : 'warning') : 
                    'error';
                
                html += `<div class="test-item ${statusClass}">`;
                html += `<strong>${result.name}</strong> `;
                
                if (result.success) {
                    html += `âœ… æˆåŠŸ (${result.status} ${result.statusText}) - ${result.duration}`;
                    if (result.data) {
                        if (typeof result.data === 'object') {
                            html += `<div class="detail">`;
                            if (result.data.success !== undefined) {
                                html += `æˆåŠŸ: ${result.data.success}<br>`;
                            }
                            if (result.data.data !== undefined) {
                                html += `æ•°æ®æ•°é‡: ${Array.isArray(result.data.data) ? result.data.data.length : 'N/A'}<br>`;
                            }
                            if (result.data.message) {
                                html += `æ¶ˆæ¯: ${result.data.message}<br>`;
                            }
                            html += `</div>`;
                            html += `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                        } else {
                            html += `<pre>${result.data}</pre>`;
                        }
                    }
                } else {
                    html += `âŒ å¤±è´¥ - ${result.duration}`;
                    if (result.status) {
                        html += `<br>çŠ¶æ€ç : ${result.status} ${result.statusText}`;
                    }
                    if (result.error) {
                        html += `<div class="detail">`;
                        html += `<strong>é”™è¯¯ç±»å‹:</strong> ${result.error.name}<br>`;
                        html += `<strong>é”™è¯¯ä¿¡æ¯:</strong> ${result.error.message}<br>`;
                        if (result.error.message.includes('Failed to fetch') || 
                            result.error.message.includes('NetworkError')) {
                            html += `<br><strong>å¯èƒ½çš„åŸå› :</strong><br>`;
                            html += `1. ç½‘ç»œè¿æ¥é—®é¢˜<br>`;
                            html += `2. CORS è·¨åŸŸé—®é¢˜<br>`;
                            html += `3. Vercel æœåŠ¡æš‚æ—¶ä¸å¯ç”¨<br>`;
                            html += `4. é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢äº†è¯·æ±‚`;
                        }
                        html += `</div>`;
                        html += `<pre>${result.error.stack}</pre>`;
                    }
                }
                html += `</div>`;
            });

            resultsDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.onload = () => {
            setTimeout(runAllTests, 500);
        };
    </script>
</body>
</html>
