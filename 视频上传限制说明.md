# 视频上传限制说明

## 问题

上传视频关卡时出现 **413 Content Too Large** 错误。

## 原因

**Vercel serverless function 有 4.5MB 的请求体限制**，这对于视频文件来说太小了。

## 解决方案

### 方案 1：压缩视频文件（推荐）

1. **使用视频压缩工具**：
   - 在线工具：https://www.freeconvert.com/video-compressor
   - 本地工具：HandBrake（免费）
   - 或使用 FFmpeg 命令行工具

2. **推荐设置**：
   - 编码格式：H.264
   - 分辨率：720p 或更低
   - 比特率：1-2 Mbps
   - 目标大小：**小于 4MB**

3. **压缩后重新上传**

### 方案 2：使用外部视频托管服务（推荐用于大文件）

如果视频文件必须保持高质量，建议使用外部视频托管服务：

1. **上传到视频平台**：
   - YouTube（需要账号）
   - Bilibili（需要账号）
   - 或其他视频托管服务

2. **获取视频 URL**：
   - YouTube：右键视频 → "复制视频 URL"
   - Bilibili：复制视频链接

3. **在关卡中填写视频 URL**：
   - 目前系统支持直接填写视频 URL
   - 学生端会自动识别并播放

### 方案 3：使用 Blob Storage 直接上传（需要开发）

对于大文件，可以使用 Blob Storage 的 presigned URL 让前端直接上传，绕过 serverless function 的限制。但这需要修改前端代码。

## 当前限制

- **Vercel serverless function**：4.5MB 请求体限制
- **后端配置**：100MB（但受 Vercel 限制）
- **实际可用**：**小于 4MB** 的视频文件

## 已完成的修复

1. ✅ 增加了 multer 文件大小限制（100MB）
2. ✅ 增加了 bodyParser 限制（100MB）
3. ✅ 添加了文件大小检查（Vercel 环境下检查 4MB）
4. ✅ 添加了友好的错误提示
5. ✅ 前端显示详细的错误信息和建议

## 建议

对于视频文件：
- **小视频（< 4MB）**：直接上传
- **大视频（> 4MB）**：使用外部视频托管服务

## 未来改进

可以考虑：
1. 实现 Blob Storage 直接上传（绕过 serverless function 限制）
2. 支持分块上传
3. 集成视频压缩服务
